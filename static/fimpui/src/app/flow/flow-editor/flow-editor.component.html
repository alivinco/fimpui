 
<div class="flow-editor">
  
  <button  style = "margin-bottom: 20px;" mat-raised-button [routerLink]="['/flow/overview']">  <mat-icon>chevron_left</mat-icon>  <mat-icon>network_check</mat-icon> Flows </button>
  
<mat-sidenav-container>
  <mat-sidenav #sidenav mode="side" opened="false" style="background-color:beige">
    <!-- sidenav content -->
    <mat-list>
    <mat-list-item><h3> Nodes </h3></mat-list-item> 
    <mat-list-item> <button mat-raised-button (click)="addNode('trigger')"  >Trigger</button> </mat-list-item>
    <mat-list-item> <button mat-raised-button (click)="addNode('time_trigger')"  >Time trigger</button> </mat-list-item>
    <mat-list-item> <button mat-raised-button (click)="addNode('action')" >Action</button> </mat-list-item>
    <mat-list-item> <button mat-raised-button (click)="addNode('receive')" >Receive</button> </mat-list-item>
    <mat-list-item> <button mat-raised-button (click)="addNode('if')" >If</button> </mat-list-item>
    <mat-list-item> <button mat-raised-button (click)="addNode('counter')" >Counter</button> </mat-list-item>
    <mat-list-item> <button mat-raised-button (click)="addNode('wait')" >Wait</button> </mat-list-item>
    <mat-list-item> <button mat-raised-button (click)="addNode('set_variable')" >Set variable</button> </mat-list-item>
    </mat-list>
  </mat-sidenav>

  <mat-card class="example-card">
    <mat-card-header>
     
      <!--<div mat-card-avatar class="example-header-image"></div>-->
      <mat-card-title><h3>Flow editor</h3></mat-card-title>
    </mat-card-header>
    <mat-card-content>
      <mat-input-container class="example-full-width">
              <input matInput [(ngModel)]="flow.Name" placeholder="Name" >
      </mat-input-container>
      <mat-input-container >
              <input style="width: 300px" matInput [(ngModel)]="flow.Description" placeholder="Description" >
      </mat-input-container>
      <p>Nodes:</p>
      
       <mat-card *ngFor="let node of flow.Nodes;let index = index;trackBy:trackByIndex;" class="node-card" >
         <mat-card-header id = "nodeId_{{node.Id}}">
            <mat-card-title>{{ node.Label }} ( Id:{{ node.Id }} ) </mat-card-title>
            <mat-card-subtitle>Node type : {{ node.Type }} </mat-card-subtitle>
         </mat-card-header>  
       <mat-card-content>
        
         <div [ngSwitch]="node.Type"  >

            <mat-input-container class="node-label-field">
                  <input matInput [(ngModel)]="flow.Nodes[index].Label" placeholder="Label" >
            </mat-input-container>
            <div *ngSwitchCase="'trigger'">  
                <trigger-node [node]="flow.Nodes[index]" [nodes]="flow.Nodes" [flowId]="flow.Id" ></trigger-node>
            </div>
            <div *ngSwitchCase="'wait'"> 
              <div #nodebody hidden> 
                  <mat-input-container style="width:100px ">
                      <input matInput type="number" [(ngModel)]="flow.Nodes[index].Config" placeholder="Delay time (milisec)" >
                  </mat-input-container>
              </div>
                  <p>
                  <mat-select #nodeIdInput style="width: 250px" class="value-selector" placeholder="Success node"[(ngModel)]="flow.Nodes[index].SuccessTransition" >
                        <mat-option value = "" > End! </mat-option>
                        <mat-option *ngFor="let nod of flow.Nodes" [value]="nod.Id" >{{nod.Label}}</mat-option>
                  </mat-select>
                  </p>
                  <p><button mat-raised-button (click)="nodebody.hidden = !nodebody.hidden" >Edit</button> </p>
            </div>
            <div *ngSwitchCase="'action'">  
                 <action-node [node]="flow.Nodes[index]" [nodes]="flow.Nodes" > </action-node>
            </div>
            <div *ngSwitchCase="'set_variable'">  
                 <set-variable-node [node]="flow.Nodes[index]" [nodes]="flow.Nodes" > </set-variable-node>
            </div> 
            <div *ngSwitchCase="'receive'">  
                 <receive-node [node]="flow.Nodes[index]" [nodes]="flow.Nodes" > </receive-node>
            </div>
            <div *ngSwitchCase="'counter'">  
                <counter-node [node]="flow.Nodes[index]" [nodes]="flow.Nodes" > </counter-node>
            </div>
            <div *ngSwitchCase="'time_trigger'">  
                <time-trigger-node [node]="flow.Nodes[index]" [nodes]="flow.Nodes" > </time-trigger-node>
           </div>                
            <div *ngSwitchCase="'if'">  
               <div #nodebody hidden>
                  <div *ngFor="let exp of flow.Nodes[index].Config.Expression;let index2 = index;trackBy:trackByIndex;">
                    
                    <div style="margin-top: 10px;">
                    <mat-select style="width: 120px" class="value-selector" (change)="variableSelected($event,flow.Nodes[index].Config.Expression[index2])" placeholder="Left value" [(ngModel)]="flow.Nodes[index].Config.Expression[index2].LeftVariableName" >
                        <mat-option value = "">Default Input</mat-option>
                        <mat-option *ngFor="let vari of localVars" [value]="vari" >{{vari}}</mat-option>
                        <mat-option *ngFor="let vari of globalVars" value="__global__{{vari}}">Shared:{{vari}}</mat-option>
                    </mat-select>

                    <mat-select style="width: 120px" class="value-selector" placeholder="Operand"[(ngModel)]="flow.Nodes[index].Config.Expression[index2].Operand" >
                        <mat-option value = "gt">greater</mat-option>
                        <mat-option value = "lt">less</mat-option>
                        <mat-option value = "eq">equals</mat-option>
                    </mat-select>
                    
                   
                    <mat-select style="width: 120px" class="value-selector" placeholder="Value type" [(ngModel)]="flow.Nodes[index].Config.Expression[index2].RightVariable.ValueType" >
                        <mat-option value = "int">int number</mat-option>
                        <mat-option value = "float">float number</mat-option>
                        <mat-option value = "string">string</mat-option>
                        <mat-option value = "bool">bool</mat-option>
                     </mat-select>
                    
                     <span [ngSwitch]="flow.Nodes[index].Config.Expression[index2].RightVariable.ValueType">  
                      <span *ngSwitchCase="'string'">
                        <mat-input-container class="node-transition-field">
                            <input matInput [(ngModel)]="flow.Nodes[index].Config.Expression[index2].RightVariable.Value" placeholder=" Right value" >
                        </mat-input-container>
                      </span>
                      <span *ngSwitchCase="'int'">
                        <mat-input-container class="node-transition-field">
                            <input matInput type="number" [(ngModel)]="flow.Nodes[index].Config.Expression[index2].RightVariable.Value" placeholder="value" >
                        </mat-input-container>
                      </span>
                      <span *ngSwitchCase="'float'">
                        <mat-input-container class="node-transition-field">
                            <input matInput type="number" [(ngModel)]="flow.Nodes[index].Config.Expression[index2].RightVariable.Value" placeholder="value" >
                        </mat-input-container>
                      </span>
                      
                      <span *ngSwitchCase="'bool'">
                        <mat-radio-group class="example-radio-group" placeholder="value" [(ngModel)]="flow.Nodes[index].Config.Expression[index2].RightVariable.Value">
                          <mat-radio-button class="example-radio-button" [value] = "true">
                            true (On)
                          </mat-radio-button>
                          <mat-radio-button class="example-radio-button" [value] = "false">
                            false (Off)
                          </mat-radio-button>
                        </mat-radio-group>
                      </span>
                    </span>   
                    </div>
                    <mat-select style="width: 200px" class="value-selector" placeholder="Boolean operation"[(ngModel)]="flow.Nodes[index].Config.Expression[index2].BooleanOperator" >
                        <mat-option value = ""></mat-option>
                        <mat-option value = "and">and</mat-option>
                        <mat-option value = "or">or</mat-option>
                        <mat-option value = "not">not</mat-option>
                    </mat-select> 
                    <button mat-raised-button (click)="addIfExpression(node)" >Add expression</button>

                  </div>
               </div>   
                  <p>
                    <mat-select #nodeIdInput style="width: 250px" class="value-selector" placeholder="True node"[(ngModel)]="flow.Nodes[index].Config.TrueTransition" >
                        <mat-option value = "" > End! </mat-option>
                        <mat-option *ngFor="let nod of flow.Nodes" [value]="nod.Id" >{{nod.Label}}</mat-option>
                    </mat-select>
                     <mat-select #nodeIdInput style="width: 250px" class="value-selector" placeholder="False node"[(ngModel)]="flow.Nodes[index].Config.FalseTransition" >
                        <mat-option value = "" > End! </mat-option>
                        <mat-option *ngFor="let nod of flow.Nodes" [value]="nod.Id" >{{nod.Label}}</mat-option>
                    </mat-select>
                  </p>
                  <p><button mat-raised-button (click)="nodebody.hidden = !nodebody.hidden" >Edit</button> </p>
                  
            </div>
         </div>
         
       </mat-card-content>  
         <mat-card-actions>
          <button mat-raised-button (click)="cloneNode(node)" >Clone</button>
          <button mat-raised-button (click)="deleteNode(node)" >Delete</button>
        </mat-card-actions>
       </mat-card>

    <button mat-mini-fab class="example-fab" (click)="sidenav.toggle()">
    <mat-icon>add</mat-icon>
  </button>
    </mat-card-content>
    
    <mat-card-actions>
      <button mat-raised-button (click)="saveFlow()" color="primary" >Save</button>
      <button mat-raised-button (click)="showSource()" color="primary" >Show source</button>
      <button mat-raised-button (click)="showContextDialog()" color="primary" >Show variables</button>

    </mat-card-actions>
  </mat-card>

 <!-- primary content -->
</mat-sidenav-container>

</div>


