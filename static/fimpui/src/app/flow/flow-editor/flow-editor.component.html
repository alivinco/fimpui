 
<div class="flow-editor">
  
  <button  style = "margin-bottom: 20px;" md-raised-button [routerLink]="['/flow/overview']">  <md-icon>chevron_left</md-icon>  <md-icon>network_check</md-icon> Flows </button>
  
<md-sidenav-container>
  <md-sidenav #sidenav mode="side" opened="false" style="background-color:beige">
    <!-- sidenav content -->
    <md-list>
    <md-list-item><h3> Nodes </h3></md-list-item> 
    <md-list-item> <button md-raised-button (click)="addNode('trigger')"  >Trigger</button> </md-list-item>
    <md-list-item> <button md-raised-button (click)="addNode('time_trigger')"  >Time trigger</button> </md-list-item>
    <md-list-item> <button md-raised-button (click)="addNode('action')" >Action</button> </md-list-item>
    <md-list-item> <button md-raised-button (click)="addNode('receive')" >Receive</button> </md-list-item>
    <md-list-item> <button md-raised-button (click)="addNode('if')" >If</button> </md-list-item>
    <md-list-item> <button md-raised-button (click)="addNode('counter')" >Counter</button> </md-list-item>
    <md-list-item> <button md-raised-button (click)="addNode('wait')" >Wait</button> </md-list-item>
    <md-list-item> <button md-raised-button (click)="addNode('set_variable')" >Set variable</button> </md-list-item>
    </md-list>
  </md-sidenav>

  <md-card class="example-card">
    <md-card-header>
     
      <!--<div md-card-avatar class="example-header-image"></div>-->
      <md-card-title><h3>Flow editor</h3></md-card-title>
    </md-card-header>
    <md-card-content>
      <md-input-container class="example-full-width">
              <input mdInput [(ngModel)]="flow.Name" placeholder="Name" >
      </md-input-container>
      <md-input-container >
              <input style="width: 300px" mdInput [(ngModel)]="flow.Description" placeholder="Description" >
      </md-input-container>
      <p>Nodes:</p>
      
       <md-card *ngFor="let node of flow.Nodes;let index = index;trackBy:trackByIndex;" class="node-card" >
         <md-card-header id = "nodeId_{{node.Id}}">
            <md-card-title>{{ node.Label }} ( Id:{{ node.Id }} ) </md-card-title>
            <md-card-subtitle>Node type : {{ node.Type }} </md-card-subtitle>
         </md-card-header>  
       <md-card-content>
        
         <div [ngSwitch]="node.Type"  >

            <md-input-container class="node-label-field">
                  <input mdInput [(ngModel)]="flow.Nodes[index].Label" placeholder="Label" >
            </md-input-container>
            <div *ngSwitchCase="'trigger'">  
                <trigger-node [node]="flow.Nodes[index]" [nodes]="flow.Nodes" [flowId]="flow.Id" ></trigger-node>
            </div>
            <div *ngSwitchCase="'wait'"> 
              <div #nodebody hidden> 
                  <md-input-container style="width:100px ">
                      <input mdInput type="number" [(ngModel)]="flow.Nodes[index].Config" placeholder="Delay time (milisec)" >
                  </md-input-container>
              </div>
                  <p>
                  <md-select #nodeIdInput style="width: 250px" class="value-selector" placeholder="Success node"[(ngModel)]="flow.Nodes[index].SuccessTransition" >
                        <md-option value = "" > End! </md-option>
                        <md-option *ngFor="let nod of flow.Nodes" [value]="nod.Id" >{{nod.Label}}</md-option>
                  </md-select>
                  </p>
                  <p><button md-raised-button (click)="nodebody.hidden = !nodebody.hidden" >Edit</button> </p>
            </div>
            <div *ngSwitchCase="'action'">  
                 <action-node [node]="flow.Nodes[index]" [nodes]="flow.Nodes" > </action-node>
            </div>
            <div *ngSwitchCase="'set_variable'">  
                 <set-variable-node [node]="flow.Nodes[index]" [nodes]="flow.Nodes" > </set-variable-node>
            </div> 
            <div *ngSwitchCase="'receive'">  
                 <receive-node [node]="flow.Nodes[index]" [nodes]="flow.Nodes" > </receive-node>
            </div>
            <div *ngSwitchCase="'counter'">  
                <counter-node [node]="flow.Nodes[index]" [nodes]="flow.Nodes" > </counter-node>
            </div>
            <div *ngSwitchCase="'time_trigger'">  
                <time-trigger-node [node]="flow.Nodes[index]" [nodes]="flow.Nodes" > </time-trigger-node>
           </div>                
            <div *ngSwitchCase="'if'">  
               <div #nodebody hidden>
                  <div *ngFor="let exp of flow.Nodes[index].Config.Expression;let index2 = index;trackBy:trackByIndex;">
                    
                    <div style="margin-top: 10px;">
                    <md-select style="width: 120px" class="value-selector" (change)="variableSelected($event,flow.Nodes[index].Config.Expression[index2])" placeholder="Left value" [(ngModel)]="flow.Nodes[index].Config.Expression[index2].LeftVariableName" >
                        <md-option value = "">Default Input</md-option>
                        <md-option *ngFor="let vari of localVars" [value]="vari" >{{vari}}</md-option>
                        <md-option *ngFor="let vari of globalVars" value="__global__{{vari}}">Shared:{{vari}}</md-option>
                    </md-select>

                    <md-select style="width: 120px" class="value-selector" placeholder="Operand"[(ngModel)]="flow.Nodes[index].Config.Expression[index2].Operand" >
                        <md-option value = "gt">greater</md-option>
                        <md-option value = "lt">less</md-option>
                        <md-option value = "eq">equals</md-option>
                    </md-select>
                    
                   
                    <md-select style="width: 120px" class="value-selector" placeholder="Value type" [(ngModel)]="flow.Nodes[index].Config.Expression[index2].RightVariable.ValueType" >
                        <md-option value = "int">int number</md-option>
                        <md-option value = "float">float number</md-option>
                        <md-option value = "string">string</md-option>
                        <md-option value = "bool">bool</md-option>
                     </md-select>
                    
                     <span [ngSwitch]="flow.Nodes[index].Config.Expression[index2].RightVariable.ValueType">  
                      <span *ngSwitchCase="'string'">
                        <md-input-container class="node-transition-field">
                            <input mdInput [(ngModel)]="flow.Nodes[index].Config.Expression[index2].RightVariable.Value" placeholder=" Right value" >
                        </md-input-container>
                      </span>
                      <span *ngSwitchCase="'int'">
                        <md-input-container class="node-transition-field">
                            <input mdInput type="number" [(ngModel)]="flow.Nodes[index].Config.Expression[index2].RightVariable.Value" placeholder="value" >
                        </md-input-container>
                      </span>
                      <span *ngSwitchCase="'float'">
                        <md-input-container class="node-transition-field">
                            <input mdInput type="number" [(ngModel)]="flow.Nodes[index].Config.Expression[index2].RightVariable.Value" placeholder="value" >
                        </md-input-container>
                      </span>
                      
                      <span *ngSwitchCase="'bool'">
                        <md-radio-group class="example-radio-group" placeholder="value" [(ngModel)]="flow.Nodes[index].Config.Expression[index2].RightVariable.Value">
                          <md-radio-button class="example-radio-button" [value] = "true">
                            true (On)
                          </md-radio-button>
                          <md-radio-button class="example-radio-button" [value] = "false">
                            false (Off)
                          </md-radio-button>
                        </md-radio-group>
                      </span>
                    </span>   
                    </div>
                    <md-select style="width: 200px" class="value-selector" placeholder="Boolean operation"[(ngModel)]="flow.Nodes[index].Config.Expression[index2].BooleanOperator" >
                        <md-option value = ""></md-option>
                        <md-option value = "and">and</md-option>
                        <md-option value = "or">or</md-option>
                        <md-option value = "not">not</md-option>
                    </md-select> 
                    <button md-raised-button (click)="addIfExpression(node)" >Add expression</button>

                  </div>
               </div>   
                  <p>
                    <md-select #nodeIdInput style="width: 250px" class="value-selector" placeholder="True node"[(ngModel)]="flow.Nodes[index].Config.TrueTransition" >
                        <md-option value = "" > End! </md-option>
                        <md-option *ngFor="let nod of flow.Nodes" [value]="nod.Id" >{{nod.Label}}</md-option>
                    </md-select>
                     <md-select #nodeIdInput style="width: 250px" class="value-selector" placeholder="False node"[(ngModel)]="flow.Nodes[index].Config.FalseTransition" >
                        <md-option value = "" > End! </md-option>
                        <md-option *ngFor="let nod of flow.Nodes" [value]="nod.Id" >{{nod.Label}}</md-option>
                    </md-select>
                  </p>
                  <p><button md-raised-button (click)="nodebody.hidden = !nodebody.hidden" >Edit</button> </p>
                  
            </div>
         </div>
         
       </md-card-content>  
         <md-card-actions>
          <button md-raised-button (click)="cloneNode(node)" >Clone</button>
          <button md-raised-button (click)="deleteNode(node)" >Delete</button>
        </md-card-actions>
       </md-card>

    <button md-mini-fab class="example-fab" (click)="sidenav.toggle()">
    <md-icon>add</md-icon>
  </button>
    </md-card-content>
    
    <md-card-actions>
      <button md-raised-button (click)="saveFlow()" color="primary" >Save</button>
      <button md-raised-button (click)="showSource()" color="primary" >Show source</button>
      <button md-raised-button (click)="showContextDialog()" color="primary" >Show variables</button>

    </md-card-actions>
  </md-card>

 <!-- primary content -->
</md-sidenav-container>

</div>


